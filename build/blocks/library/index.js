(()=>{"use strict";const e=window.wp.blocks,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"formello/library","title":"Form Library","description":"A block to display or create forms.","category":"formello","textdomain":"formello","attributes":{"ref":{"type":"number"}},"supports":{"html":false,"lock":false,"reusable":false,"inserter":true,"interactivity":true},"editorScript":"file:./index.js","viewScriptModule":"file:./view.js"}'),t=window.wp.data,l=window.wp.coreData,r=window.wp.components,n=window.wp.i18n,s=window.wp.blockEditor,a=window.wp.element,i=window.ReactJSXRuntime;function c({selectedCategory:e,patternCategories:o,onClickCategory:t}){const l="block-editor-block-patterns-explorer__sidebar";return(0,i.jsx)("div",{className:`${l}__categories-list`,children:[...new Set(o)].map((o=>(0,i.jsx)(r.Button,{label:o.name,className:`${l}__categories-list__item`,isPressed:e===o.slug,onClick:()=>{t(o.slug)},children:o.name},o.slug)))})}function d({searchValue:e,setSearchValue:o}){return(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__search",children:(0,i.jsx)(r.SearchControl,{__nextHasNoMarginBottom:!0,onChange:o,value:e,label:(0,n.__)("Search for patterns"),placeholder:(0,n.__)("Search")})})}function m({selectedCategory:e,patternCategories:o,onClickCategory:t,searchValue:l,setSearchValue:r,blockName:n}){return(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer__sidebar",children:[(0,i.jsx)(d,{searchValue:l,setSearchValue:r}),!l&&"formello/form"===n&&(0,i.jsx)(c,{selectedCategory:e,patternCategories:o,onClickCategory:t})]})}function u({clientId:e,blockName:o,onRequestClose:l}){const[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(),[_,f]=(0,a.useState)("all"),h=(0,t.useSelect)((t=>{const{getBlockRootClientId:l,getPatternsByBlockTypes:r}=t(s.store),n=l(e);return r(o,n)}),[e,o]);console.log(o);const{replaceBlock:x}=(0,t.useDispatch)(s.store),g=h.filter((e=>u?e.title.toLowerCase().includes(u):"all"===_||e.categories.includes(_))),b=[{slug:"all",name:(0,n.__)("All","formello")},{slug:"contact",name:(0,n.__)("Contact","formello")},{slug:"leads",name:(0,n.__)("Top bar","formello")},{slug:"question",name:(0,n.__)("Ad Block","formello")},{slug:"login",name:(0,n.__)("Login","formello")}];return(0,i.jsx)(r.Modal,{className:"block-editor-query-pattern__selection-modal",isFullScreen:!0,title:(0,n.__)("Choose a form","formello"),closeLabel:(0,n.__)("Cancel"),onRequestClose:l,children:(0,i.jsxs)("div",{className:"block-editor-block-patterns-explorer",children:[(0,i.jsx)(m,{selectedCategory:_,patternCategories:b,onClickCategory:f,searchValue:u,setSearchValue:p,blockName:o}),(0,i.jsx)("div",{className:"block-editor-block-patterns-explorer__list",children:(0,i.jsxs)(s.BlockContextProvider,{value:{postType:"formello_form"},children:[(0,i.jsx)(r.__experimentalConfirmDialog,{isOpen:c,onConfirm:()=>console.log("CONFIRM"),onCancel:()=>d(!1),children:"CIAO STRONZO"}),h.length?(0,i.jsx)(s.__experimentalBlockPatternsList,{blockPatterns:g,shownPatterns:g,onClickPattern:o=>{o.isPro?d(!0):x(e,o.blocks)}}):(0,i.jsx)(r.Spinner,{})]})})]})})}const p=()=>{};function _(e,o){o.forEach((o=>{e(o.clientId,"disabled"),_(e,o.innerBlocks,o.name)}))}const f=window.React;var h;function x(){return x=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var l in t)({}).hasOwnProperty.call(t,l)&&(e[l]=t[l])}return e},x.apply(null,arguments)}(0,e.registerBlockType)(o,{icon:function(e){return f.createElement("svg",x({xmlns:"http://www.w3.org/2000/svg",width:341.333,height:341.333,viewBox:"0 0 256 256"},e),h||(h=f.createElement("path",{fill:"#9b51e0",d:"M0 128v128h256V0H0v128zm145.6-66.6c2.9.7 7.8 2.8 11.1 4.5 6.7 3.6 18.3 14.6 16.8 16-2.6 2.3-31.9 23.1-32.6 23.1-.5 0-.9-.5-.9-1 0-.6-1.1-2.2-2.5-3.5-3-3.1-8.3-3.3-11.6-.6-2.2 1.8-2.4 2.7-2.7 14l-.4 12.1H136v37h-13v34H82v-44.8c0-35.5.3-46.1 1.5-51.7 3.9-18.6 18.2-34.2 35.6-38.9 6.9-1.9 19.9-2 26.5-.2z"})))},edit:function({attributes:{ref:e},clientId:o,name:c,setAttributes:d}){const[m,f]=(0,a.useState)(!1),[h,x]=(0,a.useState)(!0),[g,b]=(0,a.useState)(""),{onNavigateToEntityRecord:k,innerBlocks:C,editingMode:j}=(0,t.useSelect)((t=>{const{canUser:r}=t(l.store),{getBlocks:n,getSettings:a,getBlockEditingMode:i}=t(s.store);return{innerBlocks:n(o),userCanEdit:r("update","blocks",e),getBlockEditingMode:i,onNavigateToEntityRecord:a().onNavigateToEntityRecord,editingMode:i(o)}}),[o,e]),v=(0,s.useHasRecursion)(e),{record:w,hasResolved:y}=(0,l.useEntityRecord)("postType","formello_form",e),S=y&&!w,B=(0,t.useSelect)((e=>{const o=e("core").getEntityRecords("postType","formello_form",{per_page:-1}),t=[{value:"",label:(0,n.__)("Select a form","formello")}];return o?.forEach((e=>{t.push({value:e.id,label:e.title.raw||(0,n.__)("No title","formello")})})),t}),[]),{saveEntityRecord:N}=(0,t.useDispatch)(l.store),{setBlockEditingMode:I}=(0,t.useDispatch)(s.store);(0,a.useEffect)((()=>{_(I,C)}),[j,C,I]);const R=(0,a.useCallback)((async(e=null)=>N("postType","formello_form",{title:e,content:'\x3c!-- wp:formello/form {"lock":{"move":false,"remove":true}} --\x3e\n\t\t\t\t<form method="post" class="wp-block-formello-form" novalidate>\n\t\t\t\t<input type="hidden" name="_formello_id"/>\n\t\t\t\t<input type="text" class="formello-hp" tabindex="-1"/>\n\t\t\t\t<input type="hidden" name="action" value="formello"/>\n\t\t\t\t</form>\n\t\t\t\t\x3c!-- /wp:formello/form --\x3e',status:"publish",excerpt:""}).then((e=>{d({ref:e.id}),x(!0)}))),[N,d]),[E]=(0,l.useEntityBlockEditor)("postType","formello_form",{id:e}),M=(0,s.useBlockProps)({className:"block-library-block__reusable-block-container"}),P=(0,s.useInnerBlocksProps)(M,{templateLock:"all",value:E,onInput:p,onChange:p,editingMode:"disabled",allowedBlocks:["formello/form"],renderAppender:E?.length?void 0:s.InnerBlocks.ButtonBlockAppender});return v?(0,i.jsx)("div",{...M,children:(0,i.jsx)(s.Warning,{children:(0,n.__)("Block cannot be rendered inside itself.")})}):!e||S?(0,i.jsxs)("div",{...M,children:[(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(r.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(r.SelectControl,{label:(0,n.__)("Choose a form","formello"),options:B,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0})})}),(0,i.jsx)(r.Placeholder,{instructions:(0,n.__)("Insert from library or create a new form.","formello"),label:(0,n.__)("Insert a form","formello"),children:"widgets"===window.pagenow?(0,i.jsx)(r.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:B,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}):(0,i.jsxs)(r.__experimentalVStack,{style:{width:"100%"},children:[(0,i.jsx)(r.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:B,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0}),(0,i.jsxs)(r.__experimentalHStack,{alignment:"left",children:[(0,i.jsx)(r.Button,{isPrimary:!0,icon:"book",onClick:()=>{f("templates")},children:(0,n.__)("Open Library","formello")}),(0,i.jsx)(r.Button,{variant:"secondary",onClick:()=>{f("create")},children:(0,n.__)("Create a new form","formello")})]})]})}),"create"===m&&(0,i.jsx)(r.Modal,{title:(0,n.__)("Create Reusable form"),onRequestClose:()=>{f(!1),b("")},overlayClassName:"reusable-blocks-menu-items__convert-modal",children:(0,i.jsx)("form",{onSubmit:e=>{e.preventDefault(),R(g),f(!1),b("")},children:(0,i.jsxs)(r.__experimentalVStack,{spacing:"5",children:[(0,i.jsx)(r.TextControl,{__nextHasNoMarginBottom:!0,label:(0,n.__)("Name"),value:g,onChange:b}),(0,i.jsxs)(r.__experimentalHStack,{justify:"right",children:[(0,i.jsx)(r.Button,{variant:"tertiary",onClick:()=>{f(!1),b("")},children:(0,n.__)("Cancel")}),(0,i.jsx)(r.Button,{variant:"primary",type:"submit",children:(0,n.__)("Save")})]})]})})}),"templates"===m&&(0,i.jsx)(u,{clientId:o,onRequestClose:()=>f(!1),blockName:c})]}):S?(0,i.jsx)("div",{...M,children:(0,i.jsx)(s.Warning,{actions:[(0,i.jsx)(r.Button,{variant:"primary",onClick:()=>d({ref:""}),children:(0,n.__)("Create a new form")},"create-new")],children:(0,n.__)("Block has been deleted or is unavailable.")})}):y?(0,i.jsxs)(s.RecursionProvider,{uniqueId:e,children:[(0,i.jsx)(s.BlockControls,{children:(0,i.jsx)(r.ToolbarGroup,{children:(0,i.jsx)(r.ToolbarButton,{onClick:()=>{k({postId:e,postType:"formello_form"})},children:(0,n.__)("Edit form","formello")})})}),(0,i.jsx)(s.InspectorControls,{children:(0,i.jsx)(r.PanelBody,{title:(0,n.__)("Form Settings","formello"),initialOpen:!0,children:(0,i.jsx)(r.SelectControl,{label:(0,n.__)("Choose a form","formello"),value:e,options:B,onChange:e=>{d({ref:parseInt(e)})},__nextHasNoMarginBottom:!0})})}),(0,i.jsx)("div",{...M,children:(0,i.jsx)("div",{...P})})]}):(0,i.jsx)("div",{...M,children:(0,i.jsx)(r.Placeholder,{children:(0,i.jsx)(r.Spinner,{})})})}})})();